# クイックスタートガイド

## 前提条件

- Python 3.10以上がインストールされていること
- **Claude APIキー**を取得していること

## Claude APIキーの取得

1. https://console.anthropic.com/ にアクセス
2. アカウントを作成（GitHubまたはメールで登録）
3. 左メニューの「API Keys」をクリック
4. 「Create Key」ボタンでキーを生成
5. キーをコピー（**一度しか表示されません**）

## セットアップ手順（3ステップ）

### 1. 依存パッケージのインストール

```bash
# 仮想環境を作成（推奨）
python3 -m venv venv
source venv/bin/activate  # Windowsの場合: venv\Scripts\activate

# パッケージをインストール
pip install -r requirements.txt
```

**所要時間**: 2-3分

### 2. Claude APIキーの設定

```bash
# .envファイルを作成
cp .env.example .env
```

`.env`ファイルを開いて、APIキーを貼り付け:

```env
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxx  # ←ここにAPIキーを貼り付け
CLAUDE_MODEL=claude-sonnet-4-5-20250929
```

### 3. 起動

```bash
streamlit run app.py
```

ブラウザが自動的に開きます（開かない場合は http://localhost:8501 にアクセス）

## 使い方

### 1. ファイルアップロード

- 「📤 ファイルアップロード」タブを選択
- PDFファイルをドラッグ&ドロップまたは選択
- 「🚀 処理開始」ボタンをクリック

### 2. 見積生成

処理が自動で進みます:

```
📥 ステップ1: ドキュメント解析中...
✅ 49ページ、15テーブルを抽出

🔄 ステップ2: データを正規化中...
✅ FMTフォーマットに変換

🏷️ ステップ3: 工事区分を分類中...
✅ 5種類の工事区分を検出: 電気, 空調, 衛生, ガス, 消防

🔍 ステップ4: 過去見積データベースを準備中...
✅ RAGデータベース準備完了

💰 ステップ5: 見積を生成中... (Claudeが項目を生成)
✅ 52項目の見積を生成 (合計: ¥25,430,000)

🎉 処理完了！ (処理時間: 127秒)
```

### 3. 確認・ダウンロード

- 「📋 見積生成」タブで内容を確認
- 「📥 出力」タブでExcelファイルをダウンロード

## サンプルファイルで試す

プロジェクトに含まれているテストファイルを使用:

```
test-files/仕様書【都立山崎高等学校仮設校舎等の借入れ】.pdf
```

このファイルをアップロードすると、自動的に以下が生成されます:

- **案件名**: 都立山崎高等学校仮設校舎等の借入れ
- **施設区分**: 学校
- **工事区分**: 電気、空調、衛生、ガス、消防
- **見積項目数**: 50-60項目
- **合計金額**: 約2,000万円〜3,000万円

## トラブルシューティング

### ❌ `ModuleNotFoundError: No module named 'anthropic'`

→ パッケージがインストールされていません:

```bash
pip install -r requirements.txt
```

### ❌ `AuthenticationError: Invalid API Key`

→ APIキーが間違っているか、設定されていません:

1. `.env`ファイルが存在するか確認
2. `ANTHROPIC_API_KEY=sk-ant-...` の形式で設定されているか確認
3. APIキーをコピペし直す（余分なスペースなどに注意）

### ❌ 処理が途中で止まる

→ APIの利用制限に達している可能性があります:

1. https://console.anthropic.com/ で使用状況を確認
2. 必要に応じてクレジット追加

### ⚠️ PDFが読み込めない

→ PDFが暗号化されている場合は解除が必要です

### 🐌 処理が遅い（初回のみ）

→ 初回実行時はモデルのダウンロードで時間がかかります（5-10分）。2回目以降は高速です。

## コスト目安

Claude API使用料（目安）:

- 1件の見積生成: 約$0.10-0.30（10-30円）
- 入力トークン: 約20K tokens（仕様書PDF）
- 出力トークン: 約3K tokens（見積項目生成）

詳細: https://www.anthropic.com/pricing

## Dockerで実行

環境構築が面倒な場合:

```bash
# .envファイルを作成してAPIキーを設定
cp .env.example .env
# .envを編集

# Docker起動
docker-compose up

# http://localhost:8501 にアクセス
```

## 次のステップ

### 過去見積データを追加してRAG精度を向上

1. `kb/past_estimates/`フォルダにExcelファイルを配置
2. Excelの形式:

| 項目名 | 仕様 | 単価 | 単位 | 案件名 | 日付 | 工事区分 |
|--------|------|------|------|--------|------|----------|
| LED照明器具 | 40W相当 | 15000 | 台 | XX学校 | 2024-01-15 | 電気 |
| エアコン | 壁掛け型 | 80000 | 台 | YY施設 | 2024-02-20 | 空調 |

3. アプリで処理すると自動的にRAGデータベースに追加されます

## その他

- **ログ確認**: ターミナルに詳細ログが表示されます
- **出力先**: `output/`フォルダにExcelファイルが保存されます
- **設定変更**: `configs/config.yaml`で各種パラメータを調整可能

---

**困ったときは**: README.mdの詳細ドキュメントを参照してください
