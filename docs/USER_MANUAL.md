# ユーザーマニュアル

## 1. はじめに

本システムは、建築設備工事の仕様書PDFから見積書を自動生成するAIアプリケーションです。

### 対応工事区分

- 電気設備工事
- 機械設備工事
- ガス設備工事

### 出力形式

- 見積書PDF
- Excel（根拠情報付き）
- JSON（構造化データ）

---

## 2. アプリの起動

### 2.1 起動方法

```bash
# ターミナルで実行
cd aice-demo-eco-lease
streamlit run app.py
```

ブラウザが自動で開きます。開かない場合は `http://localhost:8501` にアクセス。

### 2.2 画面構成

| ページ | アイコン | 機能 |
|-------|---------|------|
| 見積作成 | 📋 | 仕様書から見積書を生成 |
| 単価データベース | 💰 | 過去見積から単価DBを構築 |
| 法令データベース | ⚖️ | 法令PDFから法令DBを構築 |
| 利用状況 | 📊 | API利用料金の確認 |

---

## 3. 見積書の作成

### 3.1 基本的な流れ

```
1. 仕様書PDFをアップロード
2. 生成モードを選択
3. 「生成開始」をクリック
4. 結果を確認
5. ファイルをダウンロード
```

### 3.2 手順詳細

#### ステップ1: 仕様書をアップロード

1. 「仕様書アップロード」タブを開く
2. 「Browse files」をクリック
3. 仕様書PDFを選択（複数可）
4. （任意）メール本文PDFをアップロードすると顧客名・工期を自動抽出

#### ステップ2: 法令設定を確認

サイドバーの「法令参照設定」で以下を設定：
- 法令情報を含めるかどうか
- 参照する法令（建築基準法、電気設備技術基準、ガス事業法、消防法、JEAC8001）

#### ステップ3: 生成開始

1. 「見積書を生成」ボタンをクリック
2. 処理進捗が表示されます（2-3分程度）
   - 仕様書を解析中...
   - 建物情報を抽出中...
   - 設備項目を生成中...
   - 単価をマッチング中...
   - PDF生成中...

#### ステップ4: 結果確認

「生成結果」タブで確認：
- **生成項目数**: 生成された見積項目の総数
- **単価付与**: 単価がマッチングされた項目数
- **マッチング率**: 単価付与率
- **推定総額**: 見積金額の合計

**工事区分別内訳**:
- 電気設備工事、機械設備工事、ガス設備工事などの内訳
- 各区分の項目数と小計

**生成項目一覧**:
- 項目名、仕様、数量、単位、単価、金額のテーブル

#### ステップ5: ダウンロード

「ダウンロード」タブから取得：

**一括ダウンロード**:
- 「全ファイルをZIPでダウンロード」で全ファイルをまとめて取得

**個別ダウンロード**:
- JSONデータ（構造化データ）
- 見積書PDF（印刷用）
- サマリー（テキスト形式のサマリー）

---

## 4. 単価データベースの管理

### 4.1 概要

過去の見積書から単価情報を抽出し、データベース化します。
単価DBが充実するほど、見積生成の精度が向上します。

### 4.2 単価DBの構築

1. 「単価データベース」ページへ移動
2. 「📤 見積書アップロード」で過去見積PDFを選択
3. 「抽出開始」をクリック
4. 抽出された項目を確認
5. 「KBに追加」でデータベースに保存

### 4.3 サポートファイル形式

- PDF（テキスト形式）
- PDF（スキャン形式）→ OCR処理
- Excel（.xlsx）

### 4.4 単価DBの内容確認

「現在のDB」タブで:
- 登録項目数
- 工事区分別の内訳
- 項目一覧

---

## 5. 法令データベースの管理

### 5.1 概要

関係法令PDFから法令要件を抽出し、見積項目に反映すべき事項を特定します。

### 5.2 法令DBの構築

1. 「法令データベース」ページへ移動
2. 「📤 法令PDFアップロード」で関係法令PDFを選択
3. 「抽出開始」をクリック
4. 抽出された法令要件を確認
5. 「KBに追加」で保存

### 5.3 対応法令

- 内線規程（JEAC 8001）
- 電気設備技術基準
- 消防法
- ガス事業法
- 建築基準法
- 学校施設設備基準

---

## 6. 利用状況の確認

### 6.1 概要

LLM APIの利用料金を確認できます。

### 6.2 タブ説明

**サマリータブ**:
- 累計コスト
- 操作別コスト
- 日別利用状況

**見積別コストタブ**:
- 1回の見積作成にかかったAPI料金
- セッション別の内訳

**履歴詳細タブ**:
- 個別のAPI呼び出し履歴
- トークン数、料金

**設定タブ**:
- 為替レート確認
- 履歴クリア

---

## 7. よくある質問（FAQ）

### Q1: 見積生成にどのくらい時間がかかりますか？

| モード | 時間目安 |
|-------|---------|
| AI自動生成（3工事区分） | 2-3分 |
| 参照ベース | 30秒-1分 |

### Q2: 1回の見積作成にいくらかかりますか？

| モード | 料金目安 |
|-------|---------|
| AI自動生成（3工事区分） | ¥80-120 |
| 参照ベース | ¥50-80 |
| 1工事区分のみ | ¥30-50 |

### Q3: 単価が付かない項目があります

**原因と対策**:
1. **単価DBに該当項目がない** → 過去見積をDBに追加
2. **項目名が異なる** → 類義語辞書に追加（開発者対応）
3. **工事区分が異なる** → 仕様書の工事区分を確認

### Q4: PDFのテキストが抽出できません

**原因と対策**:
1. **スキャンPDF** → 自動でOCR処理されます
2. **画像のみのPDF** → OCRに時間がかかります（1ページ3-5秒）
3. **暗号化PDF** → パスワード解除が必要

### Q5: 生成された見積書を編集したい

**方法**:
1. Excelファイルをダウンロード
2. Excelで編集
3. （将来機能）システムに再アップロード

---

## 8. 制限事項

### 8.1 ファイルサイズ

| 項目 | 制限 |
|-----|------|
| 仕様書PDF | 200MBまで |
| 1回のアップロード | 5ファイルまで |

### 8.2 処理制限

| 項目 | 制限 |
|-----|------|
| テキスト長 | 60,000文字/回 |
| 同時処理 | 1セッション |

### 8.3 対応形式

| 形式 | 対応 |
|-----|------|
| PDF（テキスト） | ◎ |
| PDF（スキャン） | ○（OCR） |
| Excel | ○ |
| Word | × |
| 画像 | × |

---

## 9. トラブルシューティング

### エラー: 「APIキーが設定されていません」

**解決策**:
1. `.env`ファイルを確認
2. `ANTHROPIC_API_KEY=xxx`が設定されているか確認
3. アプリを再起動

### エラー: 「PDF処理に失敗しました」

**解決策**:
1. PDFファイルが破損していないか確認
2. パスワード保護されていないか確認
3. 別のPDFビューアで開けるか確認

### 画面が固まった

**解決策**:
1. ブラウザをリロード（F5）
2. 別タブで `http://localhost:8501` を開く
3. ターミナルでアプリを再起動

---

## 10. お問い合わせ

### バグ報告・機能要望

GitHub Issuesで報告してください:
https://github.com/your-org/aice-demo-eco-lease/issues

### 緊急の問題

システム管理者にご連絡ください。

---

*最終更新: 2025年11月*
